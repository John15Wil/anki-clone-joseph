# 版本 1.3.0 - CSV导入功能

## 🎉 新增功能

### 📥 Anki CSV 导入

**完整的CSV导入系统**

现在可以直接导入从Anki导出的CSV文件，轻松迁移现有学习内容！

#### 核心功能

✅ **智能CSV解析**
- 自动识别逗号或制表符分隔
- 支持引号包裹字段（处理特殊字符）
- 支持多行内容（保留换行）
- 容错处理（跳过无效行）

✅ **实时预览**
- 上传后立即预览前5张卡片
- 显示卡片总数
- 展示标签（如果有）
- 可编辑卡组名称

✅ **灵活格式支持**
- 基本格式：`正面,背面`
- 带标签：`正面,背面,标签`
- 制表符分隔（Anki默认导出格式）
- 引号转义支持

✅ **批量导入**
- 一次导入所有卡片
- 自动创建新卡组
- 性能优化（bulkAdd）
- 导入后自动刷新

#### 使用流程

1. **从Anki导出**
   ```
   Anki → 文件 → 导出 → 文本文件(*.txt)
   ```

2. **导入到应用**
   ```
   首页 → CSV按钮 → 选择文件 → 预览 → 导入
   ```

3. **开始学习**
   ```
   查看新卡组 → 开始学习
   ```

#### 示例CSV格式

**基本格式：**
```csv
What is React?,A JavaScript library for building user interfaces
What is TypeScript?,A typed superset of JavaScript
```

**带标签格式：**
```csv
What is React?,A JavaScript library,frontend javascript
What is Node.js?,JavaScript runtime,backend
```

**多行内容：**
```csv
"What is AI?","Artificial Intelligence
- Machine Learning
- Deep Learning",technology
```

#### 界面改进

**新增CSV按钮**
- 位置：首页顶部导航栏
- 图标：FileText 文件图标
- 简洁设计：与其他按钮统一风格

**导入模态框**
- 优雅的弹窗设计
- 拖放区域提示
- 文件信息展示
- 实时预览卡片
- 进度反馈

**错误处理**
- 文件格式验证
- 内容解析错误提示
- 字段缺失警告
- 友好的错误信息

---

## 🎨 UI优化

### 按钮重新排列

首页顶部按钮顺序优化：
```
CSV | 导入 | 备份 | 统计 | 新建卡组
```

逻辑分组：
- **数据导入**：CSV、导入（JSON）
- **数据管理**：备份（导出）
- **数据查看**：统计
- **数据创建**：新建卡组

---

## 🔧 技术实现

### 新增文件

**`/src/lib/csvParser.ts`**
- CSV解析引擎
- 支持多种分隔符
- 引号转义处理
- 字段验证

**`/src/components/CSVImportModal.tsx`**
- React模态框组件
- 文件上传处理
- 预览展示
- 导入逻辑

### 核心功能

**CSV解析算法**
```typescript
- 检测分隔符（制表符优先，然后逗号）
- 处理引号包裹的字段
- 支持引号内的引号转义
- 自动清理字段空格
```

**数据验证**
```typescript
- 检查文件是否为空
- 验证至少有2列数据
- 过滤无效行
- 统计有效卡片数量
```

**批量导入**
```typescript
- 创建新卡组
- 生成唯一ID
- 批量添加卡片（bulkAdd）
- 更新卡组计数
```

---

## 📊 性能优化

- **文件读取**：使用 FileReader API 异步读取
- **批量写入**：IndexedDB bulkAdd 提升性能
- **内存优化**：只预览前5张卡片
- **错误恢复**：失败不影响现有数据

---

## 🚀 使用场景

### 从Anki迁移

**场景1：完整迁移**
```
1. Anki中导出所有卡组为CSV
2. 逐个导入到本应用
3. 保留原有学习进度（标签）
```

**场景2：选择性迁移**
```
1. 在Anki中筛选特定卡片
2. 导出为CSV
3. 导入到本应用的新卡组
```

### 批量创建卡片

**场景：Excel/Google Sheets制作**
```
1. 在表格软件中批量制作卡片
2. 导出为CSV
3. 直接导入
```

### 团队协作

**场景：分享学习内容**
```
1. 一人制作CSV
2. 分享给团队成员
3. 所有人导入相同内容
```

---

## 🎓 最佳实践

### 准备CSV文件

1. **使用UTF-8编码**
   - 避免中文乱码
   - 支持各种语言

2. **保持格式一致**
   - 每行都有相同列数
   - 不要有空行

3. **测试小文件**
   - 先用10张卡片测试
   - 确认格式正确再导入大量数据

4. **使用引号包裹复杂内容**
   - 内容包含逗号
   - 内容包含换行
   - 内容包含引号

### 导入建议

1. **命名规范**
   - 使用有意义的卡组名
   - 例如：英语-常用词汇、编程-React基础

2. **分类导入**
   - 不要把所有卡片导入一个卡组
   - 按主题分类导入

3. **定期备份**
   - 导入后使用"备份"功能
   - 保存JSON格式的完整数据

---

## 📋 支持的Anki导出选项

在Anki导出时：
- ✅ 文本文件 (*.txt) - **推荐**
- ✅ CSV文件 (*.csv)
- ❌ Anki卡组包 (*.apkg) - 不支持

导出设置：
- ✅ 包含调度信息 - 忽略
- ✅ 包含HTML - 保留为纯文本
- ✅ 包含标签 - 支持
- ❌ 包含媒体 - 暂不支持

---

## 🔜 未来计划

### Version 1.4.0
- [ ] 导入到已有卡组
- [ ] 支持更新已有卡片
- [ ] CSV导出功能
- [ ] 支持更多字段（难度、间隔等）

### Version 2.0.0
- [ ] 支持Anki包格式 (.apkg)
- [ ] 导入学习进度
- [ ] 图片和音频支持
- [ ] 自动同步到云端

---

## 📝 更新日志

**Version 1.3.0** - 2024-01-17

新增功能：
- ✅ Anki CSV导入支持
- ✅ 智能CSV解析引擎
- ✅ 导入预览界面
- ✅ 批量导入优化

界面优化：
- ✅ 新增CSV按钮
- ✅ 优化按钮排列
- ✅ 导入模态框设计

技术改进：
- ✅ CSV解析库
- ✅ 文件验证
- ✅ 错误处理
- ✅ 性能优化

---

**CSV导入功能已完成！** 🎉

现在可以轻松从Anki迁移数据，或批量创建学习卡片！
